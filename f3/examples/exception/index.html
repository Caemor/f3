<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="rustdoc">
    <meta name="description" content="API documentation for the Rust `exception` mod in crate `f3`.">
    <meta name="keywords" content="rust, rustlang, rust-lang, exception">

    <title>f3::examples::exception - Rust</title>

    <link rel="stylesheet" type="text/css" href="../../../rustdoc.css">
    <link rel="stylesheet" type="text/css" href="../../../main.css">
    

    
    
</head>
<body class="rustdoc">
    <!--[if lte IE 8]>
    <div class="warning">
        This old browser is unsupported and will most likely display funky
        things.
    </div>
    <![endif]-->

    

    <nav class="sidebar">
        
        <p class='location'><a href='../../index.html'>f3</a>::<wbr><a href='../index.html'>examples</a></p><script>window.sidebarCurrent = {name: 'exception', ty: 'mod', relpath: '../'};</script><script defer src="../sidebar-items.js"></script>
    </nav>

    <nav class="sub">
        <form class="search-form js-only">
            <div class="search-container">
                <input class="search-input" name="search"
                       autocomplete="off"
                       placeholder="Click or press ‘S’ to search, ‘?’ for more options…"
                       type="search">
            </div>
        </form>
    </nav>

    <section id='main' class="content mod">
<h1 class='fqn'><span class='in-band'>Module <a href='../../index.html'>f3</a>::<wbr><a href='../index.html'>examples</a>::<wbr><a class='mod' href=''>exception</a></span><span class='out-of-band'><span id='render-detail'>
                   <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">
                       [<span class='inner'>&#x2212;</span>]
                   </a>
               </span><a id='src-13' class='srclink' href='../../../src/f3/src/examples/exception.rs.html#2-79' title='goto source code'>[src]</a></span></h1>
<div class='docblock'><p>Exceptions handlers are smart! They help you find the source of crashes</p>

<p>At the end there&#39;s a program that crashes. Run it with <code>(gdb) continue</code>:</p>

<p>By the time you hit the exception, you&#39;ll see the following output in
<code>itmdump</code>:</p>

<pre><code class="language-text">$ itmdump /tmp/itm.fifo
(..)
EXCEPTION HardFault @ PC=0x080000a2
</code></pre>

<p>which indicates that this is a &quot;hard fault&quot; exception. It also tells you
were the crash originated! The PC (Program Counter) value is the address of
the instruction that generated the crash. You can disassemble your program
around that address using GDB:</p>

<pre><code class="language-text">(gdb) disas /m 0x080000a2
Dump of assembler code for function exception::main:
32      pub fn main() -&gt; ! {
   0x08000092 &lt;+0&gt;:     sub     sp, #8
   0x08000094 &lt;+2&gt;:     b.n     0x8000096 &lt;exception::main+4&gt;

33          // This reads beyond the boundary of available RAM (40KiB starting at
34          // 0x4000_0000) and triggers a hard fault exception
35          let _hard_fault_exception = unsafe {
36              *((0x4000_0000 + 40 * 1024) as *const u32)
   0x08000096 &lt;+4&gt;:     b.n     0x8000098 &lt;exception::main+6&gt;
   0x08000098 &lt;+6&gt;:     b.n     0x800009a &lt;exception::main+8&gt;
   0x0800009a &lt;+8&gt;:     movw    r0, #40960      ; 0xa000
   0x0800009e &lt;+12&gt;:    movt    r0, #16384      ; 0x4000
   0x080000a2 &lt;+16&gt;:    ldr     r0, [r0, #0]    ; &lt;--
   0x080000a4 &lt;+18&gt;:    str     r0, [sp, #4]

37          };
38
39          loop {}
   0x080000a6 &lt;+20&gt;:    b.n     0x80000a8 &lt;exception::main+22&gt;
   0x080000a8 &lt;+22&gt;:    b.n     0x80000a8 &lt;exception::main+22&gt;

End of assembler dump.
</code></pre>

<p><code>ldr r0, [r0, #0]</code> is the faulty instruction. It tries to load the word at
the address that <code>r0</code> indicates. From the two previous instructions, you can
tell that <code>r0</code> holds the value <code>0x4000a000</code>.</p>

<p>Wait! That&#39;s not everything. There&#39;s also a local <code>sf</code> variable that points
to the stack frame where the exception occurred. If you print it under GDB,
you&#39;ll see the state of several registers at the moment of the crash:</p>

<pre><code class="language-text">(gdb) p/x *sf
$1 = {r0 = 0x4000a000, r1 = 0x48001000, r2 = 0x55550000, r3 = 0x48001000,
  r12 = 0x8003950, lr = 0x8000085, pc = 0x80000a2, xpsr = 0x1000000}
</code></pre>

<p>See? <code>r0 = 0x4000a000</code> that matches our expectations from reading the
disassembly.</p>

<pre class='rust rust-example-rendered'>
<span class='attribute'>#<span class='op'>!</span>[<span class='ident'>no_main</span>]</span>
<span class='attribute'>#<span class='op'>!</span>[<span class='ident'>no_std</span>]</span>

<span class='kw'>extern</span> <span class='kw'>crate</span> <span class='ident'>f3</span>;

<span class='attribute'>#[<span class='ident'>no_mangle</span>]</span>
<span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>main</span>() <span class='op'>-&gt;</span> <span class='op'>!</span> {
    <span class='comment'>// This reads beyond the boundary of available RAM (40KiB starting at</span>
    <span class='comment'>// 0x4000_0000) and triggers an exception</span>
    <span class='kw'>let</span> <span class='ident'>_hard_fault_exception</span> <span class='op'>=</span>
        <span class='kw'>unsafe</span> { <span class='op'>*</span>((<span class='number'>0x4000_0000</span> <span class='op'>+</span> <span class='number'>40</span> <span class='op'>*</span> <span class='number'>1024</span>) <span class='kw'>as</span> <span class='op'>*</span><span class='kw'>const</span> <span class='ident'>u32</span>) };

    <span class='kw'>loop</span> {}
}</pre>
</div></section>
    <section id='search' class="content hidden"></section>

    <section class="footer"></section>

    <aside id="help" class="hidden">
        <div>
            <h1 class="hidden">Help</h1>

            <div class="shortcuts">
                <h2>Keyboard Shortcuts</h2>

                <dl>
                    <dt>?</dt>
                    <dd>Show this help dialog</dd>
                    <dt>S</dt>
                    <dd>Focus the search field</dd>
                    <dt>&larrb;</dt>
                    <dd>Move up in search results</dd>
                    <dt>&rarrb;</dt>
                    <dd>Move down in search results</dd>
                    <dt>&#9166;</dt>
                    <dd>Go to active search result</dd>
                    <dt>+</dt>
                    <dd>Collapse/expand all sections</dd>
                </dl>
            </div>

            <div class="infos">
                <h2>Search Tricks</h2>

                <p>
                    Prefix searches with a type followed by a colon (e.g.
                    <code>fn:</code>) to restrict the search to a given type.
                </p>

                <p>
                    Accepted types are: <code>fn</code>, <code>mod</code>,
                    <code>struct</code>, <code>enum</code>,
                    <code>trait</code>, <code>type</code>, <code>macro</code>,
                    and <code>const</code>.
                </p>

                <p>
                    Search functions by type signature (e.g.
                    <code>vec -> usize</code> or <code>* -> vec</code>)
                </p>
            </div>
        </div>
    </aside>

    

    <script>
        window.rootPath = "../../../";
        window.currentCrate = "f3";
    </script>
    <script src="../../../jquery.js"></script>
    <script src="../../../main.js"></script>
    <script defer src="../../../search-index.js"></script>
</body>
</html>